<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄时光</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        (function () {
            document.addEventListener('visibilitychange', function () { //浏览器切换事件
                if (document.visibilityState == 'hidden') { //状态判断
                    //normal_title=document.title;
                    document.title = '你去干嘛了?';
                    // document.getElementById('icon').target = "_blank"    
                    // href = '../images/leaveIcon.png';
                } else {
                    document.title = '欢迎回来!';
                    // document.getElementById('icon').target = "_blank"
                    // href = '../images/icon.png'; //需要修改的图片路径
                    setTimeout(function () {
                        document.title = '番茄时光';
                    }, 2000) //计时器
                }
            })
        }())
    </script>
    <style>
        html {
            font-size: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            outline: none;
        }

        a {
            color: black;
        }

        #pages {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-image: linear-gradient(25deg, #4ca8f9, #9db6e6, #d1c4d3, #fcd3bf);
        }

        #can1 {
            position: absolute;
            z-index: 10;
        }

        #pages .button {
            width: calc(100vw / 2.5);
            height: calc(100vw / 2.5);
            border-radius: 50%;
            box-shadow: 0 0 10px #000000;
            border: none;
            background-image: linear-gradient(25deg, #7551d3, #867bd7, #92a3db, #9acbde);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 2rem;
            position: absolute;
            z-index: 100;
        }

        .time {
            color: black;
            display: flex;
        }

        .over {
            position: absolute;
            bottom: .6rem;
            padding: 0 1rem 0 1rem;
        }

        .music {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 0.6rem 0.6rem 0.6rem;
            width: 100%;
        }

        .musicL {
            margin-right: 20px;
        }

        .musicR {
            margin-left: 20px;
        }

        /*无限旋转动画*/

        @keyframes changDeg {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .rotate {
            animation: changDeg 2s linear 0.2s infinite;
        }

        .times {
            position: fixed;
            left: 1rem;
            top: 48vh;
            z-index: 100;
            /* width: 3rem; */
            padding: .5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 white;
            border: none;
            background-color: rgb(253, 194, 0);
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="pages">
        <button class="times" @click="time==60?time=25:time=60">番茄时间:<br>{{time}}min</button>
        <!-- musicList[music] https://www.runoob.com/try/demo_source/horse.mp3-->
        <audio id="audio" :src="musicList[music]"></audio>
        <canvas id="can1" :width="clientWidth" :height=clientHeight></canvas>
        <button class="button" @click="button">
            <div class="music">
                <div class="musicL" @click.stop="music--">-</div>
                <div class="musicC" :class={rotate:isMusic} @click.stop="isPlay">♬</div>
                <div class="musicR" @click.stop="music++">+</div>
            </div>
            <div class="time">
                <!-- <div>{{hour}}:</div> -->
                <div>{{minute}}:</div>
                <div>{{second}}</div>
            </div>
            {{content}}
            <div class="over" @click.stop="remove">
                ╳
            </div>
        </button>
    </div>
    <script type="text/javascript">
        var t
        var vm = new Vue({
            el: '#pages',
            data: {
                hour: `00`,
                minute: `00`,
                second: `00`,
                isClick: 0,
                isMusic: 0,
                music: 0,
                content: "开始",
                clientWidth: document.body.clientWidth,
                clientHeight: document.body.clientHeight,
                angle: 0,
                musicList: [],
                time: 25
            },
            created() {},
            mounted() {
                this.getMusicList()
            },
            computed: {},
            methods: {
                // https: //bird.ioliu.cn/netease/song?id=222222
                // https://music.163.com/#/playlist?id=4942238911
                // https://bird.ioliu.cn/netease/playlist?id=4942238911
                isPlay() {
                    let audio = document.querySelector("#audio"),
                        _this = this
                    this.isMusic = !this.isMusic
                    if (audio.paused) {
                        audio.play()
                        audio.onended = function () {
                            _this.music++
                            // _this.isMusic = !_this.isMusic
                            // audio.play()
                        }
                    } else
                        audio.pause()
                    audio.setAttribute("autoplay", "")
                },
                getMusicList() {
                    let _this = this
                    axios
                        .get('https://bird.ioliu.cn/netease/playlist?id=4942238911')
                        .then(response => {
                            let list = []
                            response.data.playlist['trackIds'].filter(e => {
                                axios.get('https://bird.ioliu.cn/netease/song?id=' + e.id).then(
                                    result => {
                                        list.push(result.data.data.mp3.url)
                                    }).catch(error => {
                                    console.log(error)
                                })
                            })
                            _this.musicList = list
                        })
                        .catch(function (error) { // 请求失败处理
                            console.log(error);
                        })
                },
                clearCanvas() {
                    var c = document.getElementById("can1");
                    var cxt = c.getContext("2d");
                    c.height = this.clientHeight;
                },
                canvas() {
                    this.clearCanvas()
                    let can1 = document.getElementById("can1"),
                        ctx = can1.getContext("2d"),
                        _this = this
                    ctx.translate(_this.clientWidth / 2, _this.clientHeight / 2)
                    ctx.rotate(-90 * Math.PI / 180);
                    ctx.moveTo(0, 0)
                    ctx.arc(0, 0, _this.clientWidth >= _this.clientHeight ? _this.clientWidth : _this
                        .clientHeight, 0, _this.angle * Math.PI / 180)
                    ctx.fill() // 填充绘制路径 默认黑色
                    // ctx.stroke(); // 绘制已定义路径
                },
                remove() {
                    this.isClick = 0
                    this.minute = `00`
                    this.hour = `00`
                    this.second = `00`
                    this.content = '开始'
                    this.angle = 0
                    clearInterval(t)
                    this.clearCanvas()
                    document.querySelector("#audio").pause()
                    document.querySelector("#audio").currentTime = 0
                    this.isMusic = !this.isMusic
                },
                button() {
                    let _this = this
                    this.isClick = !this.isClick
                    if (_this.isClick) {
                        _this.content = '暂停'
                        t = setInterval(function () {
                            _this.second++;
                            _this.angle = parseFloat(360 / (_this.time * 60) + _this.angle)
                            console.log()
                            _this.canvas()
                            if (_this.second >= 60) {
                                _this.minute++;
                                _this.second = 0;
                            } else if (_this.minute >= 60) {
                                _this.hour++;
                                _this.minute = 0;
                            } else if (_this.hour == 1) {
                                _this.remove()
                                alert("已经一小时了，要适当休息鸭")
                            } else if (_this.minute == 25) {
                                _this.remove()
                                alert("时间到了，要适当休息鸭")
                            }
                        }, 1000)
                    } else if (!_this.isClick) {
                        _this.content = '开始'
                        clearInterval(t)
                    }
                }
            }
        })
    </script>
</body>

</html>